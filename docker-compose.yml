services:
  # PostgreSQL Database - COMMENTED OUT: Using existing database on host
  # postgres:
  #   image: postgres:14-alpine
  #   container_name: teleprompter-db
  #   restart: unless-stopped
  #   environment:
  #     POSTGRES_USER: ${POSTGRES_USER:-teleprompter_user}
  #     POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-teleprompter_pass}
  #     POSTGRES_DB: ${POSTGRES_DB:-teleprompter}
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #     - ./backend/migrations:/docker-entrypoint-initdb.d:ro
  #   ports:
  #     - "5432:5432"
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-teleprompter_user} -d ${POSTGRES_DB:-teleprompter}"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5

  # Go Backend
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: teleprompter-backend
    restart: unless-stopped
    environment:
      # Connect to Railway database
      DATABASE_URL: ${DATABASE_URL}
      DISABLE_TYPESENSE: ${DISABLE_TYPESENSE:-true}
      PORT: 8080
      BACKUP_DIR: /app/backups
      # ProPresenter Integration (requires Tailscale)
      PROPRESENTER_ENABLED: ${PROPRESENTER_ENABLED:-false}
      PROPRESENTER_HOST: ${PROPRESENTER_HOST:-}
      PROPRESENTER_PORT: ${PROPRESENTER_PORT:-4031}
      PROPRESENTER_PLAYLIST: ${PROPRESENTER_PLAYLIST:-Live Queue}
      TAILSCALE_AUTH_KEY: ${TAILSCALE_AUTH_KEY:-}
    volumes:
      - backups_data:/app/backups
    ports:
      - "8080:8080"

  # Next.js Frontend
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        - API_URL=${API_URL:-http://localhost:8080/api}
    container_name: teleprompter-frontend
    restart: unless-stopped
    depends_on:
      - backend
    environment:
      API_URL: ${API_URL:-http://localhost:8080/api}
    ports:
      - "3000:3000"

volumes:
  # postgres_data:  # Not needed since we're using host database
  backups_data:

